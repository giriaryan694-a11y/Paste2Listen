<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Paste2Listen</title>

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    margin: 0;
    height: 100vh;
    font-family: 'JetBrains Mono', monospace;
    background: radial-gradient(circle at top, #020617, #000);
    display: flex;
    justify-content: center;
    align-items: center;
    color: #e5e7eb;
  }

  .card {
    width: 620px;
    background: rgba(2, 6, 23, 0.95);
    border: 1px solid rgba(56,189,248,0.3);
    border-radius: 18px;
    padding: 22px;
    box-shadow: 0 0 45px rgba(56,189,248,0.35);
  }

  h1 {
    text-align: center;
    margin: 0 0 12px;
    color: #38bdf8;
    font-size: 22px;
  }

  textarea {
    width: 100%;
    height: 180px;
    background: #020617;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 12px;
    resize: vertical;
    outline: none;
  }

  textarea:focus {
    border-color: #38bdf8;
    box-shadow: 0 0 12px rgba(56,189,248,0.4);
  }

  .controls {
    margin-top: 14px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .control {
    background: #020617;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 10px;
  }

  .control label {
    font-size: 12px;
    opacity: 0.8;
    display: block;
    margin-bottom: 4px;
  }

  input[type="range"], select {
    width: 100%;
  }

  select {
    background: #020617;
    color: #e5e7eb;
    border: 1px solid #334155;
    border-radius: 8px;
    padding: 4px;
  }

  .buttons {
    margin-top: 14px;
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
  }

  button {
    padding: 10px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    background: linear-gradient(135deg, #38bdf8, #0ea5e9);
    color: #020617;
  }

  button.secondary {
    background: #020617;
    color: #38bdf8;
    border: 1px solid #38bdf8;
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(56,189,248,0.45);
  }

  footer {
    margin-top: 10px;
    text-align: center;
    font-size: 11px;
    opacity: 0.6;
  }
</style>
</head>
<body>

<div class="card">
  <h1>üîä Paste2Listen</h1>

  <textarea id="text" placeholder="Paste text here and rest your eyes..."></textarea>

  <div class="controls">
    <div class="control">
      <label>Speed (0.5x ‚Äì 2x)</label>
      <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Pitch</label>
      <input type="range" id="pitch" min="0" max="2" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Volume (Booster)</label>
      <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Voice</label>
      <select id="voice"></select>
    </div>
  </div>

  <div class="buttons">
    <button id="playBtn">‚ñ∂ Play</button>
    <button class="secondary" id="pauseBtn">‚è∏ Pause</button>
    <button class="secondary" id="stopBtn">‚èπ Stop</button>
    <button class="secondary" id="pasteBtn">üìã Paste</button>
    <button class="secondary" id="clearBtn">üßΩ Clear</button>
    <button class="secondary" id="resetBtn">üîÑ Reset Config</button>
  </div>

  <footer>
    Offline ‚Ä¢ Private ‚Ä¢ Eye-Friendly<br>
    <span style="color:#38bdf8;">Made By Aryan Giri</span>
  </footer>
</div>

<script>
const synth = window.speechSynthesis;
const voiceSelect = document.getElementById("voice");
const textEl = document.getElementById("text");
const rateEl = document.getElementById("rate");
const pitchEl = document.getElementById("pitch");
const volumeEl = document.getElementById("volume");

let utterance = null;

const DEFAULT_CONFIG = { rate: 1, pitch: 1, volume: 1, voiceIndex: 0 };

// --- Cookie helpers ---
function setCookie(name, value, days=365){
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  document.cookie = `${name}=${encodeURIComponent(value)};expires=${d.toUTCString()};path=/`;
}
function getCookie(name){
  const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\s*([^;]+)');
  return v ? decodeURIComponent(v.pop()) : null;
}

function saveConfig(){
  setCookie('rate', rateEl.value);
  setCookie('pitch', pitchEl.value);
  setCookie('volume', volumeEl.value);
  setCookie('voiceIndex', voiceSelect.value);
}

function loadConfig(){
  const rate = parseFloat(getCookie('rate')) || DEFAULT_CONFIG.rate;
  const pitch = parseFloat(getCookie('pitch')) || DEFAULT_CONFIG.pitch;
  const volume = parseFloat(getCookie('volume')) || DEFAULT_CONFIG.volume;
  const voiceIndex = parseInt(getCookie('voiceIndex'));
  
  rateEl.value = rate;
  pitchEl.value = pitch;
  volumeEl.value = volume;
  
  if(!isNaN(voiceIndex) && voiceSelect.options[voiceIndex]){
    voiceSelect.value = voiceIndex;
  } else {
    voiceSelect.value = DEFAULT_CONFIG.voiceIndex;
  }
}

function resetConfig(){
  rateEl.value = DEFAULT_CONFIG.rate;
  pitchEl.value = DEFAULT_CONFIG.pitch;
  volumeEl.value = DEFAULT_CONFIG.volume;
  voiceSelect.value = DEFAULT_CONFIG.voiceIndex;
  saveConfig();
}

// --- Load voices ---
function loadVoices(){
  let voices = synth.getVoices();
  if(!voices.length){
    setTimeout(loadVoices, 100);
    return;
  }
  voiceSelect.innerHTML = "";
  voices.forEach((v,i)=>{
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = `${v.name} (${v.lang})`;
    voiceSelect.appendChild(opt);
  });

  // restore saved voice
  const savedVoiceIndex = parseInt(getCookie('voiceIndex'));
  if(!isNaN(savedVoiceIndex) && voices[savedVoiceIndex]){
    voiceSelect.value = savedVoiceIndex;
  } else {
    const defaultIndex = voices.findIndex(v=>v.default) || 0;
    voiceSelect.value = defaultIndex;
  }
}

if('onvoiceschanged' in synth) synth.onvoiceschanged = loadVoices;
loadVoices();

voiceSelect.addEventListener('change', ()=>{
  saveConfig();
  if(utterance && synth.speaking){
    stop();
    play();
  }
});

[rateEl, pitchEl, volumeEl].forEach(el=>{
  el.addEventListener('input', saveConfig);
});

// --- Play/Pause/Stop ---
function play(){
  if(synth.paused && synth.speaking){ synth.resume(); return; }
  if(synth.speaking) synth.cancel();

  const text = textEl.value.trim();
  if(!text) return;

  utterance = new SpeechSynthesisUtterance(text);
  utterance.rate = parseFloat(rateEl.value) || 1;
  utterance.pitch = parseFloat(pitchEl.value) || 1;
  utterance.volume = parseFloat(volumeEl.value) || 1;

  const voices = synth.getVoices();
  const sel = parseInt(voiceSelect.value,10);
  if(!isNaN(sel) && voices[sel]){
    utterance.voice = voices[sel];
    if(voices[sel].lang) utterance.lang = voices[sel].lang;
  }

  synth.speak(utterance);
  saveConfig();

  utterance.onend = ()=>{ utterance=null; };
}

function pause(){ 
  if(synth.speaking && !synth.paused) synth.pause(); 
  else if(synth.paused) synth.resume(); 
}

function stop(){
  if(synth.speaking || synth.paused){ 
    synth.cancel(); 
    utterance=null; 
  }
}

async function pasteText(){
  try{
    if(navigator.clipboard && navigator.clipboard.readText){
      const clip = await navigator.clipboard.readText();
      if(clip){
        const prev = textEl.value;
        textEl.value = prev ? prev + (prev.endsWith("\n")?"":"\n")+clip : clip;
        textEl.focus();
        textEl.selectionStart = textEl.selectionEnd = textEl.value.length;
      }
    } else {
      const fallback = prompt("Paste text here:");
      if(fallback!==null){
        const prev = textEl.value;
        textEl.value = prev ? prev + (prev.endsWith("\n")?"":"\n")+fallback : fallback;
      }
    }
  }catch{
    const fallback = prompt("Could not access clipboard directly. Paste text here instead:");
    if(fallback!==null){
      const prev = textEl.value;
      textEl.value = prev ? prev + (prev.endsWith("\n")?"":"\n")+fallback : fallback;
    }
  }
}

function clearText(){ textEl.value=""; textEl.focus(); }

document.getElementById("playBtn").addEventListener("click", play);
document.getElementById("pauseBtn").addEventListener("click", pause);
document.getElementById("stopBtn").addEventListener("click", stop);
document.getElementById("pasteBtn").addEventListener("click", pasteText);
document.getElementById("clearBtn").addEventListener("click", clearText);
document.getElementById("resetBtn").addEventListener("click", resetConfig);
</script>
</body>
</html>
