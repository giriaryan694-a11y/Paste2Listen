<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paste2Listen</title>

  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin: 0;
      height: 100vh;
      font-family: 'JetBrains Mono', monospace;
      background: radial-gradient(circle at top, #020617, #000);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #e5e7eb;
    }

    .card {
      width: 620px;
      background: rgba(2, 6, 23, 0.95);
      border: 1px solid rgba(56,189,248,0.3);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 0 45px rgba(56,189,248,0.35);
    }

    h1 {
      text-align: center;
      margin: 0 0 12px;
      color: #38bdf8;
      font-size: 22px;
    }

    textarea {
      width: 100%;
      height: 180px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 12px;
      resize: vertical;
      outline: none;
    }

    textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 12px rgba(56,189,248,0.4);
    }

    .controls {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .control {
      background: #020617;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 10px;
    }

    .control label {
      font-size: 12px;
      opacity: 0.8;
      display: block;
      margin-bottom: 4px;
    }

    input[type="range"], select {
      width: 100%;
    }

    select {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 4px;
    }

    .buttons {
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(5, 1fr); /* expanded to fit Paste + Clear */
      gap: 10px;
    }

    button {
      padding: 10px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #020617;
    }

    button.secondary {
      background: #020617;
      color: #38bdf8;
      border: 1px solid #38bdf8;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(56,189,248,0.45);
    }

    footer {
      margin-top: 10px;
      text-align: center;
      font-size: 11px;
      opacity: 0.6;
    }
  </style>
</head>
<body>

<div class="card">
  <h1>üîä Paste2Listen</h1>

  <textarea id="text" placeholder="Paste text here and rest your eyes..."></textarea>

  <div class="controls">
    <div class="control">
      <label>Speed (0.5x ‚Äì 2x)</label>
      <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Pitch</label>
      <input type="range" id="pitch" min="0" max="2" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Volume (Booster)</label>
      <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
    </div>

    <div class="control">
      <label>Voice</label>
      <select id="voice"></select>
    </div>
  </div>

  <div class="buttons">
    <button id="playBtn">‚ñ∂ Play</button>
    <button class="secondary" id="pauseBtn">‚è∏ Pause</button>
    <button class="secondary" id="stopBtn">‚èπ Stop</button>
    <button class="secondary" id="pasteBtn">üìã Paste</button>
    <button class="secondary" id="clearBtn">üßΩ Clear</button>
  </div>

  <footer>
  Offline ‚Ä¢ Private ‚Ä¢ Eye-Friendly<br>
  <span style="color:#38bdf8;">Made By Aryan Giri</span>
</footer>

</div>

<script>
  // Elements
  const synth = window.speechSynthesis;
  const voiceSelect = document.getElementById("voice");
  const textEl = document.getElementById("text");
  const rateEl = document.getElementById("rate");
  const pitchEl = document.getElementById("pitch");
  const volumeEl = document.getElementById("volume");

  let utterance = null;

  function loadVoices() {
    const voices = synth.getVoices() || [];
    voiceSelect.innerHTML = "";

    if (!voices.length) {
      // fallback when no voices are available yet
      const opt = document.createElement("option");
      opt.value = -1;
      opt.textContent = "Default (no voices loaded)";
      voiceSelect.appendChild(opt);
      return;
    }

    voices.forEach((v, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${v.name} (${v.lang})`;
      voiceSelect.appendChild(opt);
    });

    // Try to pick a sensible default (match browser language if possible)
    const defaultIndex = voices.findIndex(v => v.default) || 0;
    voiceSelect.value = defaultIndex;
  }

  // Try immediate load and also listen for changes
  loadVoices();
  if ('onvoiceschanged' in synth) {
    synth.onvoiceschanged = loadVoices;
  }

  // Play function
  function play() {
    // If paused, resume
    if (synth.paused && synth.speaking) {
      synth.resume();
      return;
    }

    // If already speaking, restart by cancelling first
    if (synth.speaking) {
      synth.cancel();
    }

    const text = textEl.value.trim();
    if (!text) return;

    utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = parseFloat(rateEl.value) || 1;
    utterance.pitch = parseFloat(pitchEl.value) || 1;
    utterance.volume = parseFloat(volumeEl.value) || 1;

    // set voice safely
    const voices = synth.getVoices();
    const sel = parseInt(voiceSelect.value, 10);
    if (!isNaN(sel) && voices[sel]) {
      utterance.voice = voices[sel];
      // ensure language matches voice if available
      if (voices[sel].lang) utterance.lang = voices[sel].lang;
    }

    // cleanup when finished
    utterance.onend = () => {
      utterance = null;
    };

    synth.speak(utterance);
  }

  function pause() {
    if (synth.speaking && !synth.paused) {
      synth.pause();
    } else if (synth.paused) {
      synth.resume();
    }
  }

  function stop() {
    if (synth.speaking || synth.paused) {
      synth.cancel();
      utterance = null;
    }
  }

  async function pasteText() {
    // Use Clipboard API when available (requires secure context)
    try {
      if (navigator.clipboard && navigator.clipboard.readText) {
        const clip = await navigator.clipboard.readText();
        if (clip) {
          // append pasted text (so user doesn't lose what's already there)
          const prev = textEl.value;
          textEl.value = prev ? prev + (prev.endsWith("\n") ? "" : "\n") + clip : clip;
          textEl.focus();
          // place caret at end
          textEl.selectionStart = textEl.selectionEnd = textEl.value.length;
        }
      } else {
        // Fallback prompt if Clipboard API isn't available (rare)
        const fallback = prompt("Paste text here:");
        if (fallback !== null) {
          const prev = textEl.value;
          textEl.value = prev ? prev + (prev.endsWith("\n") ? "" : "\n") + fallback : fallback;
        }
      }
    } catch (err) {
      
      console.warn("Paste failed:", err);
      // optional fallback prompt for some browsers that block clipboard read
      const fallback = prompt("Could not access clipboard directly. Paste text here instead:");
      if (fallback !== null) {
        const prev = textEl.value;
        textEl.value = prev ? prev + (prev.endsWith("\n") ? "" : "\n") + fallback : fallback;
      }
    }
  }

  function clearText() {
    // clear the whole textarea
    textEl.value = "";
    textEl.focus();
  }

  // Attach to UI buttons
  document.getElementById("playBtn").addEventListener("click", play);
  document.getElementById("pauseBtn").addEventListener("click", pause);
  document.getElementById("stopBtn").addEventListener("click", stop);
  document.getElementById("pasteBtn").addEventListener("click", pasteText);
  document.getElementById("clearBtn").addEventListener("click", clearText);

  // Safety: when page is hidden, stop speech to avoid background speaking
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      // don't abruptly cancel if paused - but cancel to be safe
      if (synth.speaking) synth.cancel();
    }
  });
</script>

</body>
</html>
